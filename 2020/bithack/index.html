<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="WeiSch"><link rel="alternative" href="/atom.xml" title="SilentSpiral" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><title>位运算杂记 - SilentSpiral</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">SilentSpiral</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/tags">标签</a></li><li class="head-nav__item"><a class="head-nav__link" href="/archives">目录</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2020-05-06T15:06:59.000Z">2020 - 05 - 06 23:06:59</time><h1 class="post__title"><a href="/2020/bithack/">位运算杂记</a></h1><div class="post__main echo"><h1 id="二进制下去掉数字最后一个1">二进制下去掉数字最后一个1</h1>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x &amp;= x<span class="number">-1</span>;</span><br></pre></td></tr></table></figure>
<h1 id="计算数的二进制表示中有多少个1">计算数的二进制表示中有多少个1</h1>
<p>每一次n&amp;(n-1)操作 都从末尾向前去掉一个1 直到数字减少为0</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BitCount</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span>(n) &#123;</span><br><span class="line">      n = n&amp;(n<span class="number">-1</span>);</span><br><span class="line">      count++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>蠢一些的遍历方法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BitCount</span><span class="params">(<span class="keyword">uint32_t</span> n)</span> </span>&#123;</span><br><span class="line">   ulong mask = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i)&#123; <span class="comment">//31 will not do, delicate;</span></span><br><span class="line">      <span class="keyword">if</span>(mask &amp; n) count++;</span><br><span class="line">      mask &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分治">分治</h2>
<blockquote>
<p>算法思路是先求得局部个数在整合：</p>
<p>| 1 | 0 | 1 | 1 | 0 | 0 | 1 | 0 |<br>
| 0 1 | 1 0 | 0 0 | 0 1 |<br>
| 0 0 1 1 | 0 0 0 1 |<br>
| 0 0 0 0 0 1 0 0 |</p>
<p>① 第一次按1-bit划分，将成对相邻的两个1-bit相加即为每2-bit中’1’的个数。由于两位中’1’的个数最多为2所以2-bit可以表示；<br>
② 按2-bit划分，相邻两个2-bit相加即为每4-bit中’1’的个数。同样不会溢出。<br>
③ 按4-bit划分…<br>
④ 最后就能得到整个二进制中’1’的个数。</p>
<p>以32位为例的代码如下，计算时间复杂度常数且不需临时变量。</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BitCount</span><span class="params">(<span class="keyword">int</span> n)</span>  </span>&#123;  </span><br><span class="line">    n=(n &amp; <span class="number">0x55555555</span>) + ((n&gt;&gt;<span class="number">1</span>) &amp; <span class="number">0x55555555</span>);  </span><br><span class="line">    n=(n &amp; <span class="number">0x33333333</span>) + ((n&gt;&gt;<span class="number">2</span>) &amp; <span class="number">0x33333333</span>);  </span><br><span class="line">    n=(n &amp; <span class="number">0x0f0f0f0f</span>) + ((n&gt;&gt;<span class="number">4</span>) &amp; <span class="number">0x0f0f0f0f</span>);  </span><br><span class="line">    n=(n &amp; <span class="number">0x00ff00ff</span>) + ((n&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0x00ff00ff</span>);  </span><br><span class="line">    n=(n &amp; <span class="number">0x0000ffff</span>) + ((n&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0x0000ffff</span>);  </span><br><span class="line">    <span class="keyword">return</span> n;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="使用与运算将两个数字相加">使用^与&amp;运算将两个数字相加</h1>
<blockquote>
<p>异或运算又被称为半加运算，即没有进位的加法</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过a^b得到没有进位的结果，通过a&amp;b得到进位，递归相加</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getSum</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b==<span class="number">0</span>? a:getSum(a^b, (a&amp;b)&lt;&lt;<span class="number">1</span>); </span><br><span class="line">    <span class="comment">//be careful about the terminating condition;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="找到最接近给定数字的2n">找到最接近给定数字的2<sup>n</sup></h1>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实际就是定位数字最大端1的位置，将所有位置1后加一右移，即得到答案</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">largest_power</span><span class="params">(<span class="keyword">long</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//changing all right side bits to 1.</span></span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">2</span>);</span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">4</span>);</span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">8</span>);</span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> (N+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="判断数字是否是2n">判断数字是否是2<sup>n</sup></h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果X只有一个1，那么-1后，除了1的那一位，其他都会变为1，这样两个数字求与，应该得到0.</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// x will check if x == 0 and !(x &amp; (x - 1)) will check if x is a power of 2 or not</span></span><br><span class="line">   <span class="keyword">return</span> (x &amp;&amp; !(x &amp; (x - <span class="number">1</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="判断数字是否是4n">判断数字是否是4<sup>n</sup></h1>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//!(n&amp;(n-1))确定二进制中只有一个1，n&amp;0x55555555确定1的位置</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isPowerOfFour</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !(n&amp;(n<span class="number">-1</span>)) &amp;&amp; (n&amp;<span class="number">0x55555555</span>);</span><br><span class="line">    <span class="comment">//check the 1-bit location;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="返回数字二进制表示中最右侧的1">返回数字二进制表示中最右侧的1</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//x-1 将最靠右的一个1置0，并将从这个1一直到最右的位置1，与x进行与操作后，实际上是将最右的一个1置0，与原数字异或操作后，得到这个1。</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rightMostOne</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> x^x&amp;(x<span class="number">-1</span>)；</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -x = ~x + 1 所以 -x 除了最右的一个1，和这个1往右的所有数字与原数相等，</span></span><br><span class="line"><span class="keyword">int</span> rightMostOne(<span class="keyword">int</span> x)&#123;</span><br><span class="line">   <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="将二进制逆序">将二进制逆序</h1>
<blockquote>
<p>算法原理是先局部交换整合完成整体交换：</p>
<p>| 1 | 0 | 1 | 1 | 0 | 0 | 1 | 0 |<br>
| 0 1 | 1 1 | 0 0 | 0 1 |<br>
| 1 1 0 1 | 0 1 0 0 |<br>
| 0 1 0 0 1 1 0 1 |</p>
<p>① 第一次按1-bit划分，将成对相邻的两个1-bit交换。<br>
② 按2-bit划分，相邻两个2-bit交换。<br>
③ 按4-bit划分…<br>
④ 最后就能得到逆序二进制。</p>
<p>以32位为例的代码如下，计算时间复杂度常数且不需临时变量。</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BitReverse</span><span class="params">(usigned <span class="keyword">int</span> n)</span>  </span>&#123;  </span><br><span class="line">    n=((n &amp; <span class="number">0x55555555</span>)&lt;&lt;<span class="number">1</span>) | ((n &amp; <span class="number">0xaaaaaaaa</span>)&gt;&gt;<span class="number">1</span>);  </span><br><span class="line">    n=((n &amp; <span class="number">0x33333333</span>)&lt;&lt;<span class="number">2</span>) | ((n &amp; <span class="number">0xcccccccc</span>)&gt;&gt;<span class="number">2</span>);  </span><br><span class="line">    n=((n &amp; <span class="number">0x0f0f0f0f</span>)&lt;&lt;<span class="number">4</span>) | ((n &amp; <span class="number">0xf0f0f0f0</span>)&gt;&gt;<span class="number">4</span>);  </span><br><span class="line">    n=((n &amp; <span class="number">0x00ff00ff</span>)&lt;&lt;<span class="number">8</span>) | ((n &amp; <span class="number">0xff00ff00</span>)&gt;&gt;<span class="number">8</span>);  </span><br><span class="line">    n=((n &amp; <span class="number">0x0000ffff</span>)&lt;&lt;<span class="number">16</span>) | ((n &amp; <span class="number">0xffff0000</span>)&gt;&gt;<span class="number">16</span>);  </span><br><span class="line">    <span class="keyword">return</span> n;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="计算绝对值">计算绝对值</h1>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//因为i为0或-1，所以减i即是要么加0要么加1  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_abs</span><span class="params">(<span class="keyword">int</span> a)</span> <span class="comment">//正数的时候，比较好理解  </span></span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> i = a &gt;&gt; <span class="number">31</span>;  </span><br><span class="line">    <span class="comment">//负数的时候，右移数值位补进符号位，导致32个bit都是1，也就是-1，此时 i 为-1  </span></span><br><span class="line">    <span class="keyword">return</span> ((a ^ i) - i);   </span><br><span class="line">    <span class="comment">//与 -1 即0xFFFFFFFF异或就相当于取反，然后减去-1，就相当于加1，也就是取反加1,  </span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="不用temp交换两个整数">不用temp交换两个整数</h1>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> x , <span class="keyword">int</span> y)</span>  </span>&#123;  </span><br><span class="line">    x = x ^ y;  </span><br><span class="line">    y = y ^ x;  </span><br><span class="line">    x = x ^ y;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="求二进制表示数的长度">求二进制表示数的长度</h1>
<h2 id="建表二分搜索">建表+二分搜索</h2>
<blockquote>
<p>注意到输入n是32位整数，所以其二进制长度至多有32种可能，这种小规模数据很适合查表，另外，处于某一区间的所有值具有相同的二进制长度，比如，若x 属于[4, 8)，则其二进制长度为3，若x属于[16, 32)，则其二进制长度为5，不失一般性，对于任意的x属于[2^(k-1), 2^k)，其二进制长度为k，那么我们可以分如下两步完成</p>
<ol type="1">
<li><p>用Binary Search找到x所在地区间</p></li>
<li><p>返回其对应区间的二进制长度</p></li>
</ol>
<p>先建立区间表，请参看下面代码中的powof2数组，这里用数组元素值来表示区间，用下标来表示二进制长度，比如powof2[10] = 1024, powof2[11] = 2048, 则区间[1024, 2048)之内所有数值的二进制长度都是11。</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BitLength2</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="comment">// pow of 2, 2^0 - 2 ^32</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> powof2[<span class="number">33</span>] =</span><br><span class="line">    &#123;</span><br><span class="line">                 <span class="number">1</span>,           <span class="number">2</span>,           <span class="number">4</span>,           <span class="number">8</span>,         <span class="number">16</span>,          <span class="number">32</span>,</span><br><span class="line">                <span class="number">64</span>,         <span class="number">128</span>,         <span class="number">256</span>,         <span class="number">512</span>,       <span class="number">1024</span>,        <span class="number">2048</span>,</span><br><span class="line">              <span class="number">4096</span>,        <span class="number">8192</span>,       <span class="number">16384</span>,       <span class="number">32768</span>,      <span class="number">65536</span>,      <span class="number">131072</span>,</span><br><span class="line">            <span class="number">262144</span>,      <span class="number">524288</span>,     <span class="number">1048576</span>,     <span class="number">2097152</span>,    <span class="number">4194304</span>,     <span class="number">8388608</span>,</span><br><span class="line">          <span class="number">16777216</span>,    <span class="number">33554432</span>,    <span class="number">67108864</span>,   <span class="number">134217728</span>,  <span class="number">268435456</span>,   <span class="number">536870912</span>,</span><br><span class="line">        <span class="number">1073741824</span>,  <span class="number">2147483648</span>,  <span class="number">4294967295</span>,</span><br><span class="line">    &#125; ;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">int</span> right = <span class="number">32</span> ;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span> ;</span><br><span class="line">        <span class="keyword">if</span> (powof2[mid] &lt;= n)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (powof2[mid + <span class="number">1</span>] &gt; n)</span><br><span class="line">                <span class="keyword">return</span> mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(powof2[mid] == n) <span class="comment">// for max 32bit unsigned int 4294967295</span></span><br><span class="line">                <span class="keyword">return</span> mid ;</span><br><span class="line">            <span class="keyword">else</span> <span class="comment">// powof2[mid] &lt; n, search right part</span></span><br><span class="line">                left = mid + <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// powof2[mid] &gt; n, search left part</span></span><br><span class="line">            right = mid - <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span> ; <span class="comment">// not found</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二分累加">二分累加</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BitLength</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (n&gt;<span class="number">2147483647</span>) &#123;<span class="keyword">return</span> <span class="number">32</span>;&#125;</span><br><span class="line">	n&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> bsheet[]=&#123;<span class="number">16</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> tmp=n&gt;&gt;bsheet[i];</span><br><span class="line">		<span class="keyword">if</span> (tmp)&#123;</span><br><span class="line">			n=tmp;</span><br><span class="line">			cnt+=bsheet[i];</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="无分支版本">无分支版本</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BitLength</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//把数字从最高位起全用1填充.</span></span><br><span class="line">    n = n | (n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    n = n | (n&gt;&gt;<span class="number">2</span>);</span><br><span class="line">    n = n | (n&gt;&gt;<span class="number">4</span>);</span><br><span class="line">    n = n | (n&gt;&gt;<span class="number">8</span>);</span><br><span class="line">    n = n | (n&gt;&gt;<span class="number">16</span>);</span><br><span class="line">    <span class="comment">//统计1的个数</span></span><br><span class="line">    n=(n &amp; <span class="number">0x55555555</span>) + ((n&gt;&gt;<span class="number">1</span>) &amp; <span class="number">0x55555555</span>);  </span><br><span class="line">    n=(n &amp; <span class="number">0x33333333</span>) + ((n&gt;&gt;<span class="number">2</span>) &amp; <span class="number">0x33333333</span>);  </span><br><span class="line">    n=(n &amp; <span class="number">0x0f0f0f0f</span>) + ((n&gt;&gt;<span class="number">4</span>) &amp; <span class="number">0x0f0f0f0f</span>);  </span><br><span class="line">    n=(n &amp; <span class="number">0x00ff00ff</span>) + ((n&gt;&gt;<span class="number">8</span>) &amp; <span class="number">0x00ff00ff</span>);  </span><br><span class="line">    n=(n &amp; <span class="number">0x0000ffff</span>) + ((n&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0x0000ffff</span>);  </span><br><span class="line">    <span class="keyword">return</span> n;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="位扫描指令">位扫描指令</h2>
<blockquote>
<p>代码的其他片段都很好理解，重点是一条汇编指令：<code>bsr</code> 。这条汇编指令的意思是 <code>Bit Scan Reverse</code> （反向位扫描指令）。这条指令接受一个参数，会从高位扫描至低位，遇到一停止，将目标寄存器设置为该位的下标。所以，这应该是无论如何最快的取二进制最高位的方法了, 性能直逼空函数 。</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="keyword">uint32_t</span></span><br><span class="line">bsr_highest_bit(<span class="keyword">uint32_t</span> x)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (!x) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">uint32_t</span> bit;</span><br><span class="line">  <span class="keyword">asm</span>(</span><br><span class="line">    <span class="string">"bsr %1, %0"</span></span><br><span class="line">    : <span class="string">"=r"</span> (bit)</span><br><span class="line">    : <span class="string">"r"</span> (x)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> bit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="参考链接">参考链接</h1>
<p><a href="http://graphics.stanford.edu/~seander/bithacks.html" target="_blank" rel="noopener">bithacks</a></p>
<p><a href="https://blog.csdn.net/luozhaowork/article/details/10362905" target="_blank" rel="noopener">BitHacks–位操作技巧</a></p>
<p><a href="https://www.cnblogs.com/graphics/archive/2010/05/19/1739265.html" target="_blank" rel="noopener">算法-求一个二进制数的长度</a></p>
<p><a href="https://www.jianshu.com/p/3f89e96b9949" target="_blank" rel="noopener">位操作与使用位操作解题的基本思路</a></p>
<p><a href="http://m.blog.chinaunix.net/uid-24690947-id-3431252.html" target="_blank" rel="noopener">位运算的应用和分治法在二进制中的应用</a></p>
<p><a href="https://lhy1024.github.io/log_and_lcm/" target="_blank" rel="noopener">对数和最小公倍数</a></p>
<p><a href="https://www.clarkok.com/blog/2015/06/13/%E5%8F%96%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%9C%80%E9%AB%98%E4%BD%8D%E7%9A%84%E4%B8%80/" target="_blank" rel="noopener">取二进制最高位的一</a></p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/算法/">算法</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/位运算/">位运算</a></li></ul></footer></article><section class="reward"><a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechat.png" title="微信"></div></section><div class="comments" id="v-container"><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/js/Valine.min.js"></script><script>new Valine({
  av: AV,
  el: '#v-container',
  app_id: 'IQzWzzCuitLQe0yLWG4VzRS6-gzGzoHsz',
  app_key: 'cs2RLiJ2qtHhAcFv0GnEELvz',
  avatar: 'retro',
  avatarForce: false,
  notify: false,
  verify: false,
  lang: 'zh-cn',
  placeholder: '来啊快活啊~',
  pageSize: 10,
  visitor: true,
  highlight: true,
  emoticon_url: '/img/alu',
  emoticon_list: ["吐.png","喷血.png","狂汗.png","不说话.png","汗.png","坐等.png","献花.png","不高兴.png","中刀.png","害羞.png","皱眉.png","小眼睛.png","中指.png","尴尬.png","瞅你.png","想一想.png","中枪.png","得意.png","肿包.png","扇耳光.png","亲亲.png","惊喜.png","脸红.png","无所谓.png","便便.png","愤怒.png","蜡烛.png","献黄瓜.png","内伤.png","投降.png","观察.png","看不见.png","击掌.png","抠鼻.png","邪恶.png","看热闹.png","口水.png","抽烟.png","锁眉.png","装大款.png","吐舌.png","无奈.png","长草.png","赞一个.png","呲牙.png","无语.png","阴暗.png","不出所料.png","咽气.png","期待.png","高兴.png","吐血倒地.png","哭泣.png","欢呼.png","黑线.png","喜极而泣.png","喷水.png","深思.png","鼓掌.png","暗地观察.png"],
});</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2018 - 2020 WeiSch</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>